<figure class="bunny-text-space">
<div class="frow">
  <div class="frow">
    <div id="icons-column" class="fcolumn">
      <div class="icons">
        {{#each range(1) as i}}
          <div class="icon {{(x == i)? 'selected' : ''}}" on:click='set({x: i})'>
            <Sprite src_class={{sprite_class}} size=80 sprite_size=128 y=0 x={{i}} sprite_scale=0.99/>
          </div>
        {{/each}}
        <div class="icon {{(x == 1)? 'selected' : ''}}" on:click='set({x: 1})'>
          Orientation
        </div>
        <div class="icon {{(x == 2)? 'selected' : ''}}" on:click='set({x: 2})'>
          Seams
        </div>
        <div class="icon {{(x == 3)? 'selected' : ''}}" on:click='set({x: 3})'>
          Resolution
        </div>
      </div>
    </div>
  </div>

  <div class="fcolumn centered">
    {{#await resourcePromise}}
      <p>Loading the 3D model...</p>
    {{then resources}}
      <THREEjsGuidedView ref:view resources={{resources}} :texture_url :width :height :backgroundColor camId={{x}}></THREEjsGuidedView>
    {{catch error}}
      <p>A problem occurred while loading the 3D model!</p>
    {{/await}}
  </div>
  <div class="frow">
    <div id="icons-column" class="fcolumn">
      <div class="icons">
        <div class="icon {{(texture_file == '/3Dfeatureviz/texture_space.jpg')? 'selected' : ''}}" on:click="set({texture_file: '/3Dfeatureviz/texture_space.jpg'})">
          Na√Øve
        </div>
        <div class="icon {{(texture_file == '/3Dfeatureviz/texture_0.jpg')? 'selected' : ''}}" on:click="set({texture_file: '/3Dfeatureviz/texture_0.jpg'})">
          Rendered
        </div>
      </div>
  </div>
</div>

</figure>

<style>
  figure {
    grid-column: text;
    grid-auto-flow: column;
  }

  .selection_sprite {
    background-image: url('models/bunny/3Dfeatureviz/naive_sprite.png')
  }


    /* FRow & FColumn */

    .frow {
      display: flex;
      flex-flow: row;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    .fcolumn {
      display: flex;
      flex-flow: column;
      margin-right: 10px;
      margin-bottom: 10px;
      z-index: 2;
    }

    /* Icons */
    .icons {
      display: flex;
      flex-wrap: wrap;
      flex-direction: row;
      margin-bottom: 7px;
      max-width: 100px;
      /*border-bottom: 1px solid #dddddd;*/
    }

    .icons .icon {
      cursor: pointer;
      padding-bottom: 6px;
      margin-bottom: 11px;

      /*margin-left: 3px;*/
      margin-right: 6px;
      border-bottom: 1px solid #dddddd;
    }

    .icons .icon.selected {
      opacity: 100%;
      padding-bottom: 3px;
      border-bottom: 3px solid #ff6600;
    }

    .icon div {
      opacity: 0.666;
      image-rendering: auto;
    }

    .icon.selected div {
      opacity: 1;
    }

    #icons-column {
      order: 1
    }

    .result {
      z-index: 3;
    }


    .img-container {
      background-image: url('images/checkerboard.png')
    }


    @media (min-width: 1024px) {

      .fcolumn {
        margin-left: 10px;
      }

      .fcolumn:first-of-type {
        margin-left: 0;
      }

      .fcolumn:last-of-type {
        margin-right: 0;
      }

      #icons-column {
        order: 1
      }

      .bunny-text-space {
        margin-bottom: 0px;
      }
    }

</style>

<script>

import THREEjsGuidedView from '../components/THREEjsGuidedView';
import Sprite from '../components/Sprite.html';

function range(n){
  return Array(n).fill().map((_, i) => i);
}

export default {
  components: { THREEjsGuidedView, Sprite },
  oncreate() {
  },
  data() {
    return {
      model_folder: 'models/bunny',
      faces_file: 'face.3d',
      positions_file: 'position.3d',
      uvs_file: 'uv.3d',
      sprite_class: 'selection_sprite',
      texture_file: '/3Dfeatureviz/texture_space.jpg',
      resourcesReady: false,
      backgroundColor: '#f8f8f8',
      width: 480,
      height: 400,
      x: 0
    }
  },
  computed: {
    texture_url: (model_folder, texture_file) => {
      return model_folder + '/' + texture_file;
    },
    resources: (model_folder, faces_file, positions_file, uvs_file) => {
      return new Map([
        ['positions', [model_folder + '/' + positions_file, Float32Array]],
        ['uvs', [model_folder + '/' + uvs_file, Float32Array]],
        ['faces', [model_folder + '/' + faces_file, Uint16Array]],
      ]);
    },
    resourcePromise: (resources) => {
      return Promise.all([...resources].map(([resource, [path, DType]]) => {
        return fetch(path).then((response) => {
          return response.arrayBuffer();
        }).then((arrayBuffer) => {
          return new DType(arrayBuffer);
        });
      }));
    }
  },
  methods: {
  },
  helpers: {range}
}
</script>
