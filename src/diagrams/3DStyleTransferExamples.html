<figure class="style-3d">

<div class="frow">
  <div>
    <div id="icons-row" class="frow">
      <div class="icons">
        {{#each range(10) as i}}
          <div class="icon {{(x == i)? 'selected' : ''}}" on:click='set({x: i})'>
            <div style="background-image: url({{styles[i].src}})"  class="{{styles[i].rotated? 'rotated' : ''}}"></div>
          </div>
        {{/each}}
      </div>
    </div>
    <div id="style-img" class="sprite frow">
      <div style="background-image: url({{styles[x].src}})" class="{{styles[x].rotated? 'rotated' : ''}}"></div>
    </div>
    <div>
      <a href="{{styles[x].link}}">{{styles[x].title}}</a>
    </div>
  </div>

  <div class="frow">

    <div class="THREEjsview">
      {{#await resourcePromise}}
        <p>Loading the 3D model...</p>
      {{then resources}}
        <THREEjsView ref:view resources={{resources}} texture_url={{texture_url}} :backgroundColor :width :height></THREEjsView>
      {{catch error}}
        <p>A problem occurred while loading the 3D model!</p>
      {{/await}}
    </div>
  </div>
</div>

</figure>

<style>
  figure {
    grid-column: text;
    grid-auto-flow: column;
  }

  .sprite span {

  }
  .sprite div {
    /* flex: 1 1; */
    position: relative;
    /* width: 1vw; */
    /* height: 10vw; */
    /* height: 0; */
    /* padding-top: 100%; */
    background-size: cover;
    background-position: center;
    /* object-fit: contain; */
    width: 275px;
    height: 275px;
  }
  .sprite div:before {
    content: "";
  	display: block;
  	padding-top: 100%; 	/* initial ratio of 1:1*/
  }


    /* FRow & frow */

    .frow {
      display: flex;
      flex-flow: row;
      flex-wrap: wrap;
      justify-content: flex-start;
    }


    .icons {
      display: flex;
      flex-wrap: wrap;
      flex-direction: row;
      justify-content: space-between;
      margin-bottom: 7px;
      max-width: calc(55px * 5 + 6px);
      /*border-bottom: 1px solid #dddddd;*/
    }
    .icons .icon {
      cursor: pointer;
      padding-bottom: 6px;
      margin-bottom: 11px;

      /*margin-left: 3px;*/
      /* margin-right: 6px; */
      border-bottom: 1px solid #dddddd;
    }
    .icons .icon.selected {
      opacity: 100%;
      padding-bottom: 3px;
      border-bottom: 3px solid #ff6600;
    }
    .icon div {
      opacity: 0.5;
      image-rendering: auto;
      width: 55px;
      height: 55px;
      background-size: cover;
      background-position: center;
    }
    .icon.selected div {
      opacity: 1;
    }
    #icons-row {
      order: 1
    }

    .result {
      z-index: 3;
    }

    .rotated {
      transform: rotate(90deg);
    }

    .img-container {
      background-image: url('images/checkerboard.png')
    }


    @media (min-width: 1024px) {

      .frow {
        margin-left: 10px;
      }

      .frow:first-of-type {
        margin-left: 0;
      }

      .frow:last-of-type {
        margin-right: 0;
      }

      #icons-row {
        order: 1
      }

      .style-3d {
        margin-bottom: 0px;
      }
    }

</style>

<script>
import THREEjsView from '../components/THREEjsView';
import Sprite from '../components/Sprite.html';

function range(n){
  return Array(n).fill().map((_, i) => i);
}

export default {
  components: { THREEjsView, Sprite },
  oncreate() {
  },
  data() {
    return {
      model_folder: 'models/bunny',
      faces_file: 'face.3d',
      positions_file: 'position.3d',
      uvs_file: 'uv.3d',
      resourcesReady: false,
      backgroundColor: '#f8f8f8',
      x: 0,
      width: 600,
      height: 400,
      styles: [
        {
          texture: 'models/bunny/3Dstyles/texture_cd.jpg',
          src: 'models/bunny/3Dstyles/styles/cd.jpg',
          title: 'CD',
          link: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/CD_autolev_crop.jpg/480px-CD_autolev_crop.jpg"
        },
        {
          texture: 'models/bunny/3Dstyles/texture_cross.jpg',
          src: 'models/bunny/3Dstyles/styles/cross.jpg',
          title: 'Cross stitch detail',
          link: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Cross_stitch_detail.jpg/640px-Cross_stitch_detail.jpg"
        },
        {
          texture: 'models/bunny/3Dstyles/texture_galaxy.jpg',
          src: 'models/bunny/3Dstyles/styles/galaxy.jpg',
          title: 'Galaxy',
          link: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/NGC_4414_%28NASA-med%29.jpg/582px-NGC_4414_%28NASA-med%29.jpg",
        },
        {
          texture: 'models/bunny/3Dstyles/texture_mosaic.jpg',
          src: 'models/bunny/3Dstyles/styles/mosaic.jpg',
          title: "Leger's Grand Parade",
          link: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Fernand_L%C3%A9ger_-_Grand_parade_with_red_background_%28mosaic%29_1958_made.jpg/637px-Fernand_L%C3%A9ger_-_Grand_parade_with_red_background_%28mosaic%29_1958_made.jpg",
        },
        {
          texture: 'models/bunny/3Dstyles/texture_newspaper.jpg',
          src: 'models/bunny/3Dstyles/styles/newspaper.jpg',
          title: 'Newspaper',
          link: "https://upload.wikimedia.org/wikipedia/commons/d/db/RIAN_archive_409362_Literaturnaya_Gazeta_article_about_YuriGagarin%2C_first_man_in_space.jpg"
        },
        {
          texture: 'models/bunny/3Dstyles/texture_noodles.jpg',
          src: 'models/bunny/3Dstyles/styles/noodles.jpg',
          title: 'Noodles and eggs',
          link:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d9/Noodles_and_eggs20170520_1035.jpg/526px-Noodles_and_eggs20170520_1035.jpg"
        },
        {
          texture: 'models/bunny/3Dstyles/texture_onwhite.jpg',
          src: 'models/bunny/3Dstyles/styles/on_white.jpg',
          title: "Kandinsky's On White",
          link: "https://upload.wikimedia.org/wikipedia/commons/c/c4/Vassily_Kandinsky%2C_1923_-_On_White_II.jpg"
        },
        {
          texture: 'models/bunny/3Dstyles/texture_points.jpg',
          src: 'models/bunny/3Dstyles/styles/points.jpg',
          title: "Delaunay's Portrait de Metzinger",
          link: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Robert_Delaunay%2C_1906%2C_Portrait_de_Metzinger%2C_oil_on_canvas%2C_55_x_43_cm%2C_DSC08255.jpg/449px-Robert_Delaunay%2C_1906%2C_Portrait_de_Metzinger%2C_oil_on_canvas%2C_55_x_43_cm%2C_DSC08255.jpg",
        },
        {
          texture: 'models/bunny/3Dstyles/texture_scream.jpg',
          src: 'models/bunny/3Dstyles/styles/scream.jpg',
          title: "Munch's The Scream",
          link: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/The_Scream.jpg/471px-The_Scream.jpg"
        },
        {
          texture: 'models/bunny/3Dstyles/texture_starry.jpg',
          src: 'models/bunny/3Dstyles/styles/starry_night.jpg',
          title: "Van Gogh's Starry Night ",
          link: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg/606px-Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg",
        },

      ]
    }
  },
  computed: {
    texture_url: (styles,x) => {
      return styles[x].texture;
    },
    title: (styles,x) => {
      return styles[x].title;
    },
    resources: (model_folder, faces_file, positions_file, uvs_file) => {
      return new Map([
        ['positions', [model_folder + '/' + positions_file, Float32Array]],
        ['uvs', [model_folder + '/' + uvs_file, Float32Array]],
        ['faces', [model_folder + '/' + faces_file, Uint16Array]],
      ]);
    },
    resourcePromise: (resources) => {
      return Promise.all([...resources].map(([resource, [path, DType]]) => {
        return fetch(path).then((response) => {
          return response.arrayBuffer();
        }).then((arrayBuffer) => {
          return new DType(arrayBuffer);
        });
      }));
    }
  },
  methods: {
  },
  helpers: {range}
}
</script>
